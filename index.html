<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Falling Objects Game - FOR DESSI and EVA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            text-align: center;
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .game-info {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .game-info div {
            margin: 8px 0;
            font-size: 14px;
            color: #333;
        }

        .game-info strong {
            color: #667eea;
        }

        #gameCanvas {
            display: block;
            background: #1a1a2e;
            width: 100%;
            max-width: 800px;
            height: 500px;
            border: 3px solid #667eea;
            border-radius: 12px;
            margin: 20px auto;
            cursor: crosshair;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        #btnStart {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 14px 32px;
            font-size: 18px;
        }

        #btnStart:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        #btnStart:active {
            transform: translateY(0);
        }

        #btnPause, #btnResume, #btnStop {
            background: #f39c12;
            color: white;
        }

        #btnPause:hover, #btnResume:hover, #btnStop:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        #btnMusic {
            background: #9b59b6;
            color: white;
        }

        #btnMusic:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #eee;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .hint {
            text-align: center;
            color: #666;
            font-size: 13px;
            margin-top: 20px;
            line-height: 1.6;
        }

        .hint strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ FALLING OBJECTS GAME</h1>
        <div class="subtitle">FOR DESSI and EVA</div>

        <div class="game-info">
            <div><strong>üìä –£—Ä–æ–≤–Ω–∏:</strong> 100 —Ä–∞–∑–ª–∏—á–Ω–∏ –Ω–∏–≤–∞</div>
            <div><strong>üéµ –ú—É–∑–∏–∫–∞:</strong> –í–∫–ª. —Ñ–æ–Ω–æ–≤–∞ –º—É–∑–∏–∫–∞</div>
            <div><strong>üéØ –ü–∞–¥–∞—â–∏ –æ–±–µ–∫—Ç–∏:</strong> –ï–º–æ–¥–∂–∏ –∏ —Ñ–æ—Ä–º–∏</div>
            <div><strong>üåà –¢–µ–º–∏:</strong> 5 —Ä–∞–∑–ª–∏—á–Ω–∏ —Ñ–æ–Ω–∞ (Night, Day, Factory, Ocean, Space)</div>
            <div><strong>üìà –¢—Ä—É–¥–Ω–æ—Å—Ç:</strong> –†–∞—Å—Ç—è—â–∞ —Å –≤—Å—è–∫–æ –Ω–∏–≤–æ</div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div class="controls">
            <button id="btnStart">üöÄ START</button>
            <button id="btnPause">‚è∏Ô∏è PAUSE</button>
            <button id="btnResume">‚ñ∂Ô∏è RESUME</button>
            <button id="btnStop">‚èπÔ∏è STOP</button>
            <button id="btnMusic">üîä MUSIC: ON</button>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">Level</div>
                <div class="stat-value"><span id="level">1</span>/100</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Objects</div>
                <div class="stat-value" id="objects">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Time</div>
                <div class="stat-value"><span id="time">0.0</span>s</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Progress</div>
                <div id="progress" style="height: 30px; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 6px; margin-top: 8px;"></div>
            </div>
        </div>

        <div class="hint">
            <strong>‚å®Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª–∏:</strong> Arrow Keys –∏–ª–∏ WASD –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ | Mouse Click & Drag –∑–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞—ö–µ | 25 —Å–µ–∫—É–Ω–¥–∏ –Ω–∞ –Ω–∏–≤–æ<br>
            <strong>üéØ –¶–µ–ª:</strong> –°—ä–±–µ—Ä–∏ –º–∞–∫—Å–∏–º—É–º –ø–∞–¥–∞—â–∏ –æ–±–µ–∫—Ç–∏ –ø—Ä–µ–¥–∏ –≤—Ä–µ–º–µ—Ç–æ –¥–∞ —Å–≤—ä—Ä—à–∏
        </div>
    </div>

    <!-- BACKGROUND MUSIC -->
    <audio id="bgMusic" loop style="display:none;">
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ============ GAME STATE ============
        const game = {
            canvas: document.getElementById("gameCanvas"),
            ctx: null,
            bgMusic: document.getElementById("bgMusic"),
            status: "IDLE", // IDLE, RUNNING, PAUSED, STOPPED
            level: 0,
            time: 0,
            levelDuration: 25, // seconds
            objects: [],
            player: { x: 400, y: 460, w: 110, h: 18, color: "#22e246" },
            keys: {},
            mouse: { x: 400, y: 460, pressed: false },
            score: 0,
            lastFrame: 0,
            musicMuted: false,
            animationFrameId: 0
        };

        game.ctx = game.canvas.getContext("2d");

        // ============ THEMES ============
        const themes = [
            { name: "night", bg: "#020617", bg2: "#020b3d" },
            { name: "day", bg: "#9ad9ff", bg2: "#e9f7ff" },
            { name: "factory", bg: "#2b103e", bg2: "#7e3ff2" },
            { name: "ocean", bg: "#1a5f7a", bg2: "#0d4a63" },
            { name: "space", bg: "#000011", bg2: "#0a0033" }
        ];

        const emojis = {
            animals: ["üê∂", "üê±", "ü¶ä", "üêª", "üê∞", "ü¶Å", "üêº"],
            fruits: ["üçé", "üçä", "üçã", "üçå", "üçâ", "üçì", "üåª"],
            tools: ["üîß", "üõ†", "‚öô", "üî©", "ü™ö", "üî®", "ü™õ"],
            sea: ["üê†", "üêü", "üê°", "ü¶à", "üêô", "ü¶ë", "üêö"],
            space: ["‚≠ê", "üåü", "‚ú®", "üí´", "üîÜ", "ü™ê", "üõ∏"]
        };

        // ============ UTILITIES ============
        function randomBetween(min, max) {
            return Math.random() * (max - min) + min;
        }

        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // ============ DRAW BACKGROUND ============
        function drawBackground() {
            const themeIndex = game.level % 5;
            const theme = themes[themeIndex];
            const w = game.canvas.width;
            const h = game.canvas.height;

            const grad = game.ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, theme.bg);
            grad.addColorStop(1, theme.bg2);
            game.ctx.fillStyle = grad;
            game.ctx.fillRect(0, 0, w, h);

            // Theme-specific decorations
            if (themeIndex === 0) { // night - stars
                game.ctx.fillStyle = "#ffffff";
                for (let i = 0; i < 50; i++) {
                    const x = Math.sin(i * 12.9898) * 10000 % w;
                    const y = Math.cos(i * 78.233) * 10000 % h;
                    game.ctx.beginPath();
                    game.ctx.arc(x, y, 1, 0, Math.PI * 2);
                    game.ctx.fill();
                }
            } else if (themeIndex === 1) { // day - grass
                game.ctx.fillStyle = "#6cc070";
                game.ctx.fillRect(0, h - 40, w, 40);
            } else if (themeIndex === 2) { // factory - lines
                game.ctx.strokeStyle = "rgba(255,255,255,0.1)";
                game.ctx.lineWidth = 2;
                for (let i = 0; i < 6; i++) {
                    game.ctx.beginPath();
                    game.ctx.moveTo((i * w) / 6, 0);
                    game.ctx.lineTo((i * w) / 6, h);
                    game.ctx.stroke();
                }
            } else if (themeIndex === 3) { // ocean - waves
                game.ctx.strokeStyle = "rgba(255,255,255,0.15)";
                game.ctx.lineWidth = 2;
                for (let i = 0; i < 5; i++) {
                    game.ctx.beginPath();
                    game.ctx.arc(w / 2, h / 2 + i * 40, 60 - i * 10, 0, Math.PI * 2);
                    game.ctx.stroke();
                }
            } else if (themeIndex === 4) { // space - purple overlay
                game.ctx.fillStyle = "rgba(200, 100, 255, 0.1)";
                game.ctx.fillRect(0, 0, w / 2, h / 2);
            }
        }

        // ============ CREATE FALLING OBJECT ============
        function createObject() {
            const difficulty = 0.7 + game.level * 0.15;
            const speed = 80 + difficulty * 100;
            const x = Math.random() * (game.canvas.width - 40) + 20;

            const themeIndex = game.level % 5;
            let emoji;
            switch (themeIndex) {
                case 0: emoji = randomChoice(emojis.animals); break;
                case 1: emoji = randomChoice(emojis.fruits); break;
                case 2: emoji = randomChoice(emojis.tools); break;
                case 3: emoji = randomChoice(emojis.sea); break;
                case 4: emoji = randomChoice(emojis.space); break;
            }

            return {
                x: x,
                y: -30,
                emoji: emoji,
                speed: speed,
                size: 32,
                alive: true
            };
        }

        // ============ UPDATE ============
        function update(deltaTime) {
            // Update time
            game.time += deltaTime;

            // Check level complete
            if (game.time >= game.levelDuration) {
                if (game.objects.length === 0) {
                    game.level++;
                    if (game.level >= 100) {
                        game.status = "STOPPED";
                        alert("üéâ YOU WON! All 100 levels completed!");
                    } else {
                        game.time = 0;
                        game.objects = [];
                    }
                }
            }

            // Spawn new objects
            const difficulty = 0.7 + game.level * 0.15;
            const spawnRate = Math.max(0.05, 0.3 - game.level * 0.002);
            if (Math.random() < spawnRate) {
                game.objects.push(createObject());
            }
            
            // Limit max objects on screen
            if (game.objects.length > 30) {
                game.objects.splice(0, 5);
            }

            // Update player position
            const moveSpeed = 420;
            if (game.keys["ArrowLeft"] || game.keys["a"] || game.keys["A"]) {
                game.player.x -= moveSpeed * deltaTime;
            }
            if (game.keys["ArrowRight"] || game.keys["d"] || game.keys["D"]) {
                game.player.x += moveSpeed * deltaTime;
            }
            if (game.keys["ArrowUp"] || game.keys["w"] || game.keys["W"]) {
                game.player.y -= moveSpeed * deltaTime;
            }
            if (game.keys["ArrowDown"] || game.keys["s"] || game.keys["S"]) {
                game.player.y += moveSpeed * deltaTime;
            }

            // Clamp player to canvas
            game.player.x = Math.max(game.player.w / 2, Math.min(game.canvas.width - game.player.w / 2, game.player.x));
            game.player.y = Math.max(game.player.h / 2, Math.min(game.canvas.height - game.player.h / 2, game.player.y));

            // Update objects
            for (let i = game.objects.length - 1; i >= 0; i--) {
                const obj = game.objects[i];
                obj.y += obj.speed * deltaTime;

                // Check collision with player
                if (obj.y > game.player.y - 30 &&
                    obj.y < game.player.y + game.player.h &&
                    obj.x > game.player.x - game.player.w / 2 &&
                    obj.x < game.player.x + game.player.w / 2) {
                    game.objects.splice(i, 1);
                    game.score++;
                    playSound(800, 100, 0.3);
                } else if (obj.y > game.canvas.height) {
                    game.objects.splice(i, 1);
                }
            }
        }

        // ============ DRAW ============
        function draw() {
            drawBackground();

            // Draw objects
            game.ctx.font = "32px Arial";
            game.ctx.textAlign = "center";
            game.ctx.textBaseline = "middle";
            game.objects.forEach(obj => {
                game.ctx.fillText(obj.emoji, obj.x, obj.y);
            });

            // Draw player
            game.ctx.fillStyle = game.player.color;
            game.ctx.fillRect(
                game.player.x - game.player.w / 2,
                game.player.y - game.player.h / 2,
                game.player.w,
                game.player.h
            );

            // Draw score overlay
            game.ctx.fillStyle = "rgba(0,0,0,0.5)";
            game.ctx.fillRect(0, 0, game.canvas.width, 40);
            game.ctx.fillStyle = "#fff";
            game.ctx.font = "16px Arial";
            game.ctx.textAlign = "left";
            game.ctx.textBaseline = "top";
            game.ctx.fillText(`Level: ${game.level + 1}/100`, 10, 10);
            game.ctx.fillText(`Objects: ${game.objects.length}`, 200, 10);
            game.ctx.fillText(`Time: ${game.time.toFixed(1)}s / ${game.levelDuration}s`, 400, 10);
        }

        // ============ GAME LOOP ============
        function gameLoop(timestamp) {
            if (!game.lastFrame) game.lastFrame = timestamp;
            const deltaTime = (timestamp - game.lastFrame) / 1000;
            game.lastFrame = timestamp;

            if (game.status === "RUNNING") {
                update(deltaTime);
                draw();

                // Update HUD
                document.getElementById("level").textContent = game.level + 1;
                document.getElementById("objects").textContent = game.objects.length;
                document.getElementById("time").textContent = game.time.toFixed(1);
                document.getElementById("progress").style.width = ((game.time / game.levelDuration) * 100) + "%";
            }

            game.animationFrameId = requestAnimationFrame(gameLoop);
        }

        // ============ SOUND ============
        let audioCtx = null;
        function playSound(freq, ms, vol) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            try {
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(vol, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + ms / 1000);
                osc.start(now);
                osc.stop(now + ms / 1000);
            } catch (e) {}
        }

        // ============ CONTROLS ============
        document.getElementById("btnStart").addEventListener("click", () => {
            game.status = "RUNNING";
            game.level = 0;
            game.time = 0;
            game.objects = [];
            game.score = 0;
            game.lastFrame = 0;
            if (!game.musicMuted) game.bgMusic.play();
            gameLoop(performance.now());
        });

        document.getElementById("btnPause").addEventListener("click", () => {
            if (game.status === "RUNNING") {
                game.status = "PAUSED";
                game.bgMusic.pause();
            }
        });

        document.getElementById("btnResume").addEventListener("click", () => {
            if (game.status === "PAUSED") {
                game.status = "RUNNING";
                if (!game.musicMuted) game.bgMusic.play();
            }
        });

        document.getElementById("btnStop").addEventListener("click", () => {
            game.status = "STOPPED";
            game.bgMusic.pause();
            cancelAnimationFrame(game.animationFrameId);
            game.ctx.clearRect(0, 0, game.canvas.width, game.canvas.height);
            drawBackground();
        });

        document.getElementById("btnMusic").addEventListener("click", () => {
            if (game.musicMuted) {
                game.musicMuted = false;
                game.bgMusic.play();
                document.getElementById("btnMusic").textContent = "üîä MUSIC: ON";
            } else {
                game.musicMuted = true;
                game.bgMusic.pause();
                document.getElementById("btnMusic").textContent = "üîá MUSIC: OFF";
            }
        });

        // Keyboard
        window.addEventListener("keydown", e => game.keys[e.key] = true);
        window.addEventListener("keyup", e => game.keys[e.key] = false);

        // Mouse
        game.canvas.addEventListener("mousemove", e => {
            const rect = game.canvas.getBoundingClientRect();
            game.player.x = (e.clientX - rect.left) * (game.canvas.width / rect.width);
        });

        // Touch
        game.canvas.addEventListener("touchmove", e => {
            e.preventDefault();
            const rect = game.canvas.getBoundingClientRect();
            const touch = e.touches[0];
            game.player.x = (touch.clientX - rect.left) * (game.canvas.width / rect.width);
        });

        // Initial draw
        drawBackground();
    </script>
</body>
</html>
